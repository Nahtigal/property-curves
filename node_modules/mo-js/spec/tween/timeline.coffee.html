<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title> - timeline.coffee</title>

  <link rel="stylesheet" href="../../../assets/style.css">
  
    
      <style>
        
      </style>
    
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"/>
  <meta name="groc-relative-root" content="../../../"/>
  <meta name="groc-document-path" content="../spec/tween/timeline.coffee"/>
  
</head>
<body>
  <div id="file-area">
    <div id="meta">
      <code class="file-path">
      
        <a href="https://github.com/legomushroom/mojs.git/blob/master/../spec/tween/timeline.coffee">../spec/tween/timeline.coffee</a>
      
      </code>
    </div>
    <div id="document">
    
      <div class="segment">
      
      
        <div class="code"><div class="wrapper">Timeline = <span class="hljs-built_in">window</span>.mojs.Timeline
easing   = <span class="hljs-built_in">window</span>.mojs.easing
    
describe <span class="hljs-string">'Timeline -&gt;'</span>, <span class="hljs-function">-&gt;</span>
  describe <span class="hljs-string">'init -&gt;'</span>, <span class="hljs-function">-&gt;</span>
    it <span class="hljs-string">'calc totalDuration and totalTime'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline <span class="hljs-attribute">duration</span>: <span class="hljs-number">1000</span>, <span class="hljs-attribute">delay</span>: <span class="hljs-number">100</span>
      expect(t.props.totalDuration).toBe  <span class="hljs-number">1000</span>
      expect(t.props.totalTime).toBe      <span class="hljs-number">1100</span>
      t = <span class="hljs-keyword">new</span> Timeline <span class="hljs-attribute">duration</span>: <span class="hljs-number">1000</span>, <span class="hljs-attribute">delay</span>: <span class="hljs-number">100</span>, <span class="hljs-attribute">repeat</span>: <span class="hljs-number">5</span>
      expect(t.props.totalDuration).toBe  <span class="hljs-number">6500</span>
      expect(t.props.totalTime).toBe      <span class="hljs-number">6600</span>
  describe <span class="hljs-string">'defaults -&gt;'</span>, <span class="hljs-function">-&gt;</span>
    it <span class="hljs-string">'should have vars'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline
      expect(t.props) .toBeDefined()
      expect(t.h)     .toBeDefined()
      expect(t.progress).toBe <span class="hljs-number">0</span>
    it <span class="hljs-string">'should have defaults'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline
      expect(t.defaults.duration).toBe  <span class="hljs-number">600</span>
      expect(t.defaults.delay).toBe     <span class="hljs-number">0</span>
      expect(t.defaults.yoyo).toBe      <span class="hljs-literal">false</span>
      expect(t.defaults.isChained).toBe <span class="hljs-literal">false</span>
    it <span class="hljs-string">'should extend defaults to options'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline <span class="hljs-attribute">duration</span>: <span class="hljs-number">1000</span>
      expect(t.o.duration).toBe   <span class="hljs-number">1000</span>
      expect(t.o.delay).toBe      <span class="hljs-number">0</span>

  describe <span class="hljs-string">'isChained option -&gt;'</span>, <span class="hljs-function">-&gt;</span>
    it <span class="hljs-string">'should recieve isChained option'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline
        <span class="hljs-attribute">duration</span>: <span class="hljs-number">1000</span>, <span class="hljs-attribute">isChained</span>: <span class="hljs-literal">true</span>
      expect(t.o.isChained).toBe  <span class="hljs-literal">true</span>
    it <span class="hljs-string">'should fallback to default isChained option'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline
        <span class="hljs-attribute">duration</span>: <span class="hljs-number">1000</span>
      expect(t.o.isChained).toBe <span class="hljs-literal">false</span>

  describe <span class="hljs-string">'start -&gt;'</span>, <span class="hljs-function">-&gt;</span>
    it <span class="hljs-string">'should calculate start time'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">duration</span>: <span class="hljs-number">1000</span>, <span class="hljs-attribute">delay</span>: <span class="hljs-number">500</span>).start()
      now = performance.now() + <span class="hljs-number">500</span>
      expect(t.props.startTime).<span class="hljs-keyword">not</span>.toBeGreaterThan now
      expect(t.props.startTime).toBeGreaterThan     now-<span class="hljs-number">50</span>
    it <span class="hljs-string">'should recieve the start time'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">duration</span>: <span class="hljs-number">1000</span>).start <span class="hljs-number">1</span>
      expect(t.props.startTime).toBe <span class="hljs-number">1</span>
    it <span class="hljs-string">'should calculate end time'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">duration</span>: <span class="hljs-number">1000</span>, <span class="hljs-attribute">delay</span>: <span class="hljs-number">500</span>).start()
      expect(t.props.endTime).toBe t.props.startTime + <span class="hljs-number">1000</span>
    it <span class="hljs-string">'should calculate end time if repeat'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">duration</span>: <span class="hljs-number">1000</span>, <span class="hljs-attribute">delay</span>: <span class="hljs-number">500</span>, <span class="hljs-attribute">repeat</span>: <span class="hljs-number">2</span>).start()
      expect(t.props.endTime).toBe t.props.startTime+(<span class="hljs-number">3</span>*(<span class="hljs-number">1000</span>+<span class="hljs-number">500</span>))-<span class="hljs-number">500</span>
    it <span class="hljs-string">'should restart flags'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">duration</span>: <span class="hljs-number">20</span>, <span class="hljs-attribute">repeat</span>: <span class="hljs-number">2</span>).start()
      t.update t.props.startTime + <span class="hljs-number">10</span>
      t.update t.props.startTime + <span class="hljs-number">60</span>
      expect(t.isCompleted).toBe <span class="hljs-literal">true</span>
      expect(t.isStarted)  .toBe <span class="hljs-literal">true</span>
      t.start()
      expect(t.isCompleted).toBe <span class="hljs-literal">false</span>
      expect(t.isStarted)  .toBe <span class="hljs-literal">false</span>
  describe <span class="hljs-string">'update time -&gt;'</span>, <span class="hljs-function">-&gt;</span>
    it <span class="hljs-string">'should update progress'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">duration</span>: <span class="hljs-number">1000</span>, <span class="hljs-attribute">delay</span>: <span class="hljs-number">500</span>)
      t.start()
      time = t.props.startTime + <span class="hljs-number">200</span>
      t.update time
      expect(t.progress).toBe .<span class="hljs-number">2</span>
    it <span class="hljs-string">'should update progress with repeat'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">duration</span>: <span class="hljs-number">1000</span>, <span class="hljs-attribute">delay</span>: <span class="hljs-number">200</span>, <span class="hljs-attribute">repeat</span>: <span class="hljs-number">2</span>)
      t.start()
      t.update t.props.startTime + <span class="hljs-number">1400</span>
      expect(t.progress).toBe .<span class="hljs-number">2</span>
      t.update t.props.startTime + <span class="hljs-number">2700</span>
      expect(t.progress).toBe .<span class="hljs-number">3</span>
      t.update t.props.startTime + <span class="hljs-number">3400</span>
      expect(t.progress).toBe <span class="hljs-number">1</span>
    it <span class="hljs-string">'should update progress to 0 if in delay gap'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">duration</span>: <span class="hljs-number">1000</span>, <span class="hljs-attribute">delay</span>: <span class="hljs-number">200</span>, <span class="hljs-attribute">repeat</span>: <span class="hljs-number">2</span>)
      t.start()
      t.update t.props.startTime + <span class="hljs-number">1100</span>
      expect(t.progress).toBe <span class="hljs-number">0</span>
    it <span class="hljs-string">'should update progress to 1 on the end'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">duration</span>: <span class="hljs-number">1000</span>, <span class="hljs-attribute">delay</span>: <span class="hljs-number">200</span>, <span class="hljs-attribute">repeat</span>: <span class="hljs-number">2</span>)
      t.start()
      t.update t.props.startTime + <span class="hljs-number">1000</span>
      expect(t.progress).toBe <span class="hljs-number">1</span>
    it <span class="hljs-string">'should not call update method if timeline isnt active "-"'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">duration</span>: <span class="hljs-number">1000</span>, <span class="hljs-attribute">onUpdate</span>:<span class="hljs-function">-&gt;</span>)
      t.start()
      spyOn t, <span class="hljs-string">'onUpdate'</span>
      t.update(performance.now() - <span class="hljs-number">500</span>)
      expect(t.onUpdate).<span class="hljs-keyword">not</span>.toHaveBeenCalled()
    it <span class="hljs-string">'should not call update method if timeline isnt active "+"'</span>, <span class="hljs-function">-&gt;</span>
      cnt = <span class="hljs-number">0</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">duration</span>: <span class="hljs-number">1000</span>, <span class="hljs-attribute">onUpdate</span>:<span class="hljs-function">-&gt;</span> cnt++ )
      t.start(); t.update(performance.now() + <span class="hljs-number">1500</span>)
      expect(cnt).toBe <span class="hljs-number">1</span>
    it <span class="hljs-string">'should set Timeline to the end if Timeline ended'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">duration</span>: <span class="hljs-number">1000</span>, <span class="hljs-attribute">delay</span>: <span class="hljs-number">500</span>)
      t.start()
      t.update t.props.startTime + <span class="hljs-number">1200</span>
      expect(t.progress).toBe <span class="hljs-number">1</span>
  describe <span class="hljs-string">'onUpdate callback -&gt;'</span>, <span class="hljs-function">-&gt;</span>
    it <span class="hljs-string">'should be defined'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline <span class="hljs-attribute">onUpdate</span>: <span class="hljs-function">-&gt;</span>
      expect(t.o.onUpdate).toBeDefined()
    it <span class="hljs-string">'should call onUpdate callback with the current progress'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline <span class="hljs-attribute">duration</span>: <span class="hljs-number">1000</span>, <span class="hljs-attribute">easing</span>: <span class="hljs-string">'bounce.out'</span>, <span class="hljs-attribute">onUpdate</span>: <span class="hljs-function">-&gt;</span>
      spyOn t, <span class="hljs-string">'onUpdate'</span>
      t.start()
      t.update t.props.startTime + <span class="hljs-number">500</span>
      expect(t.onUpdate).toHaveBeenCalledWith t.easedProgress
    it <span class="hljs-string">'should have the right scope'</span>, <span class="hljs-function">-&gt;</span>
      isRightScope = <span class="hljs-literal">false</span>
      t = <span class="hljs-keyword">new</span> Timeline <span class="hljs-attribute">onUpdate</span>:<span class="hljs-function">-&gt;</span> isRightScope = @ <span class="hljs-keyword">instanceof</span> Timeline
      t.start()
      t.update t.props.startTime + <span class="hljs-number">200</span>
      expect(isRightScope).toBe <span class="hljs-literal">true</span>
  describe <span class="hljs-string">'onStart callback -&gt;'</span>, <span class="hljs-function">-&gt;</span>
    it <span class="hljs-string">'should be defined'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">onStart</span>: <span class="hljs-function">-&gt;</span>)
      t.start()
      expect(t.o.onStart).toBeDefined()
    it <span class="hljs-string">'should call onStart callback'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline <span class="hljs-attribute">duration</span>: <span class="hljs-number">32</span>, <span class="hljs-attribute">onStart</span>:<span class="hljs-function">-&gt;</span>
      t.start()
      spyOn(t.o, <span class="hljs-string">'onStart'</span>)
      t.update t.props.startTime + <span class="hljs-number">1</span>
      expect(t.o.onStart).toHaveBeenCalled()
    it <span class="hljs-string">'should be called just once'</span>, <span class="hljs-function">-&gt;</span>
      cnt = <span class="hljs-number">0</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">duration</span>: <span class="hljs-number">32</span>, <span class="hljs-attribute">onStart</span>:<span class="hljs-function">-&gt;</span> cnt++).start()
      t.update(t.props.startTime + <span class="hljs-number">1</span>); t.update(t.props.startTime + <span class="hljs-number">1</span>)
      expect(cnt).toBe <span class="hljs-number">1</span>
    it <span class="hljs-string">'should have the right scope'</span>, <span class="hljs-function">-&gt;</span>
      isRightScope = <span class="hljs-literal">false</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">onStart</span>:<span class="hljs-function">-&gt;</span> isRightScope = @ <span class="hljs-keyword">instanceof</span> Timeline)
      t.start()
      t.update t.props.startTime + <span class="hljs-number">1</span>
      expect(isRightScope).toBe <span class="hljs-literal">true</span>

  describe <span class="hljs-string">'onReverseComplete callback -&gt;'</span>, <span class="hljs-function">-&gt;</span>
    it <span class="hljs-string">'should be defined'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline <span class="hljs-attribute">onReverseComplete</span>: <span class="hljs-function">-&gt;</span>
      expect(t.o.onReverseComplete).toBeDefined()

    it <span class="hljs-string">'should call onReverseComplete callback'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline(
        <span class="hljs-attribute">duration</span>: <span class="hljs-number">100</span>
        <span class="hljs-attribute">onReverseComplete</span>:<span class="hljs-function">-&gt;</span>
      ).start()
      spyOn(t.o, <span class="hljs-string">'onReverseComplete'</span>)
      t.update t.props.startTime + <span class="hljs-number">55</span>
      t.update t.props.startTime
      expect(t.o.onReverseComplete).toHaveBeenCalled()

    it <span class="hljs-string">'should onReverseComplete only once'</span>, <span class="hljs-function">-&gt;</span>
      cnt = <span class="hljs-number">0</span>
      t = <span class="hljs-keyword">new</span> Timeline(
        <span class="hljs-attribute">duration</span>: <span class="hljs-number">100</span>
        <span class="hljs-attribute">onReverseComplete</span>:<span class="hljs-function">-&gt;</span> cnt++
      ).start()
      t.update t.props.startTime + <span class="hljs-number">55</span>
      t.update t.props.startTime
      t.update t.props.startTime - <span class="hljs-number">20</span>
      t.update t.props.startTime - <span class="hljs-number">30</span>
      expect(cnt).toBe <span class="hljs-number">1</span>
      expect(t.isOnReverseComplete).toBe <span class="hljs-literal">true</span>

    it <span class="hljs-string">'should reset isOnReverseComplete flag'</span>, <span class="hljs-function">-&gt;</span>
      cnt = <span class="hljs-number">0</span>
      t = <span class="hljs-keyword">new</span> Timeline(
        <span class="hljs-attribute">duration</span>: <span class="hljs-number">100</span>
        <span class="hljs-attribute">onReverseComplete</span>:<span class="hljs-function">-&gt;</span> cnt++
      ).start()
      t.update t.props.startTime + <span class="hljs-number">55</span>
      t.update t.props.startTime
      t.update t.props.startTime - <span class="hljs-number">20</span>
      t.update t.props.startTime - <span class="hljs-number">30</span>
      t.update t.props.startTime + <span class="hljs-number">1</span>
      expect(t.isOnReverseComplete).toBe <span class="hljs-literal">false</span>

    it <span class="hljs-string">'should reset isOnReverseComplete flag #2'</span>, <span class="hljs-function">-&gt;</span>
      cnt = <span class="hljs-number">0</span>
      t = <span class="hljs-keyword">new</span> Timeline(
        <span class="hljs-attribute">duration</span>: <span class="hljs-number">100</span>
        <span class="hljs-attribute">onReverseComplete</span>:<span class="hljs-function">-&gt;</span> cnt++
      ).start()
      t.update t.props.startTime + <span class="hljs-number">55</span>
      t.update t.props.startTime
      t.update t.props.startTime - <span class="hljs-number">20</span>
      t.update t.props.startTime - <span class="hljs-number">30</span>
      t.update t.props.endTime
      expect(t.isOnReverseComplete).toBe <span class="hljs-literal">false</span>

    it <span class="hljs-string">'should have the right scope'</span>, <span class="hljs-function">-&gt;</span>
      isRightScope = <span class="hljs-literal">null</span>
      t = <span class="hljs-keyword">new</span> Timeline(
        <span class="hljs-attribute">duration</span>: <span class="hljs-number">100</span>
        <span class="hljs-attribute">onReverseComplete</span>:<span class="hljs-function">-&gt;</span> isRightScope = @ <span class="hljs-keyword">instanceof</span> Timeline
      ).start()
      t.update t.props.startTime + <span class="hljs-number">55</span>
      t.update t.props.startTime
      expect(isRightScope).toBe <span class="hljs-literal">true</span>

    it <span class="hljs-string">'should setProgress to 0 if progress went before startTime'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline(
        <span class="hljs-attribute">duration</span>: <span class="hljs-number">100</span>
        <span class="hljs-attribute">onReverseComplete</span>:<span class="hljs-function">-&gt;</span>
        <span class="hljs-attribute">onUpdate</span>:<span class="hljs-function">-&gt;</span>
      ).start()
      spyOn(t, <span class="hljs-string">'onUpdate'</span>)
      t.update t.props.startTime + <span class="hljs-number">55</span>
      t.update t.props.startTime - <span class="hljs-number">20</span>
      expect(t.onUpdate).toHaveBeenCalledWith <span class="hljs-number">0</span>
      expect(t.progress).toBe <span class="hljs-number">0</span>

    it <span class="hljs-string">'should not setProgress to 0 if timeline isChained'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline(
        <span class="hljs-attribute">duration</span>: <span class="hljs-number">100</span>, <span class="hljs-attribute">isChained</span>: <span class="hljs-literal">true</span>
        <span class="hljs-attribute">onReverseComplete</span>:<span class="hljs-function">-&gt;</span>
        <span class="hljs-attribute">onUpdate</span>:<span class="hljs-function">-&gt;</span>
      ).start()
      spyOn(t, <span class="hljs-string">'onUpdate'</span>)
      t.update t.props.startTime + <span class="hljs-number">55</span>
      t.update t.props.startTime - <span class="hljs-number">20</span>
      expect(t.onUpdate).<span class="hljs-keyword">not</span>.toHaveBeenCalledWith <span class="hljs-number">0</span></div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>expect(t.progress).toBe 0</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">  describe <span class="hljs-string">'onComplete callback -&gt;'</span>, <span class="hljs-function">-&gt;</span>
    it <span class="hljs-string">'should be defined'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline <span class="hljs-attribute">onComplete</span>: <span class="hljs-function">-&gt;</span>
      expect(t.o.onComplete).toBeDefined()
    it <span class="hljs-string">'should call onComplete callback'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">duration</span>: <span class="hljs-number">100</span>, <span class="hljs-attribute">onComplete</span>:<span class="hljs-function">-&gt;</span>).start()
      spyOn(t.o, <span class="hljs-string">'onComplete'</span>)
      t.update t.props.startTime + <span class="hljs-number">101</span>
      expect(t.o.onComplete).toHaveBeenCalled()
    it <span class="hljs-string">'should be called just once'</span>, <span class="hljs-function">-&gt;</span>
      cnt = <span class="hljs-number">0</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">duration</span>: <span class="hljs-number">32</span>, <span class="hljs-attribute">onComplete</span>:<span class="hljs-function">-&gt;</span> cnt++).start()
      t.update(t.props.startTime + <span class="hljs-number">33</span>)
      t.update(t.props.startTime + <span class="hljs-number">33</span>)
      expect(cnt).toBe <span class="hljs-number">1</span>

    it <span class="hljs-string">'should reset isCompleted flag'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">duration</span>: <span class="hljs-number">32</span>, <span class="hljs-attribute">onComplete</span>:<span class="hljs-function">-&gt;</span>).start()
      t.update(t.props.startTime + <span class="hljs-number">10</span>)
      t.update(t.props.endTime)
      expect(t.isCompleted).toBe <span class="hljs-literal">true</span>
      t.update(t.props.startTime + <span class="hljs-number">10</span>)
      expect(t.isCompleted).toBe <span class="hljs-literal">false</span>

    it <span class="hljs-string">'should have the right scope'</span>, <span class="hljs-function">-&gt;</span>
      isRightScope = <span class="hljs-literal">false</span>
      t = <span class="hljs-keyword">new</span> Timeline
        <span class="hljs-attribute">duration</span>: <span class="hljs-number">1</span>, <span class="hljs-attribute">onComplete</span>:<span class="hljs-function">-&gt;</span> isRightScope = @ <span class="hljs-keyword">instanceof</span> Timeline
      t.start().update t.props.startTime + <span class="hljs-number">2</span>
      expect(isRightScope).toBe <span class="hljs-literal">true</span>

    it <span class="hljs-string">'should fire after the last onUpdate'</span>, <span class="hljs-function"><span class="hljs-params">(dfr)</span>-&gt;</span>
      proc = <span class="hljs-number">0</span>
      t = <span class="hljs-keyword">new</span> Timeline
        <span class="hljs-attribute">duration</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attribute">onUpdate</span>:<span class="hljs-function"><span class="hljs-params">(p)</span>-&gt;</span>  proc = p
        <span class="hljs-attribute">onComplete</span>:<span class="hljs-function">-&gt;</span> expect(proc).toBe(<span class="hljs-number">1</span>); dfr()
      t.start().update t.props.startTime + <span class="hljs-number">2</span>
      

  describe <span class="hljs-string">'onFirstUpdate callback -&gt;'</span>, <span class="hljs-function">-&gt;</span>
    it <span class="hljs-string">'should be defined'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline <span class="hljs-attribute">onFirstUpdate</span>: <span class="hljs-function">-&gt;</span>
      expect(t.o.onFirstUpdate).toBeDefined()
    it <span class="hljs-string">'should call onFirstUpdate callback'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">duration</span>: <span class="hljs-number">100</span>, <span class="hljs-attribute">onFirstUpdate</span>:<span class="hljs-function">-&gt;</span>).start()
      spyOn(t.o, <span class="hljs-string">'onFirstUpdate'</span>)
      t.update t.props.startTime + <span class="hljs-number">3</span>
      expect(t.o.onFirstUpdate).toHaveBeenCalled()
    it <span class="hljs-string">'should be called just once'</span>, <span class="hljs-function">-&gt;</span>
      cnt = <span class="hljs-number">0</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">duration</span>: <span class="hljs-number">100</span>, <span class="hljs-attribute">onFirstUpdate</span>:<span class="hljs-function">-&gt;</span> cnt++ ).start()
      t.update t.props.startTime + <span class="hljs-number">3</span>
      t.update t.props.startTime + <span class="hljs-number">3</span>
      t.update t.props.startTime + <span class="hljs-number">3</span>
      expect(cnt).toBe <span class="hljs-number">1</span>
    it <span class="hljs-string">'should have the right scope'</span>, <span class="hljs-function">-&gt;</span>
      isRightScope = <span class="hljs-literal">false</span>
      t = <span class="hljs-keyword">new</span> Timeline
        <span class="hljs-attribute">duration</span>: <span class="hljs-number">10</span>, <span class="hljs-attribute">onFirstUpdate</span>:<span class="hljs-function">-&gt;</span> isRightScope = @ <span class="hljs-keyword">instanceof</span> Timeline
      t.start().update t.props.startTime + <span class="hljs-number">2</span>
      expect(isRightScope).toBe <span class="hljs-literal">true</span>
    it <span class="hljs-string">'should be called after progress went further the timeline'</span>, <span class="hljs-function">-&gt;</span>
      isRightScope = <span class="hljs-literal">false</span>
      t = <span class="hljs-keyword">new</span> Timeline
        <span class="hljs-attribute">duration</span>: <span class="hljs-number">10</span>
        <span class="hljs-attribute">onFirstUpdate</span>:<span class="hljs-function">-&gt;</span>
      .start()
      t.update t.props.startTime + <span class="hljs-number">1</span>
      t.update t.props.startTime + <span class="hljs-number">12</span>
      spyOn(t.o, <span class="hljs-string">'onFirstUpdate'</span>)
      t.update t.props.startTime + <span class="hljs-number">9</span>
      expect(t.o.onFirstUpdate).toHaveBeenCalled()

    it <span class="hljs-string">'should be called before onStart callback'</span>, <span class="hljs-function">-&gt;</span>
      isOnStart = <span class="hljs-literal">false</span>; isOnStartCalled = <span class="hljs-literal">true</span>
      t = <span class="hljs-keyword">new</span> Timeline
        <span class="hljs-attribute">duration</span>: <span class="hljs-number">10</span>
        <span class="hljs-attribute">onStart</span>:<span class="hljs-function">-&gt;</span> isOnStart = <span class="hljs-literal">true</span>
        <span class="hljs-attribute">onFirstUpdate</span>:<span class="hljs-function">-&gt;</span> isOnStartCalled = isOnStart
      .start()
      t.update t.props.startTime + <span class="hljs-number">1</span>
      expect(isOnStartCalled).toBe <span class="hljs-literal">false</span>

    it <span class="hljs-string">'should be called after progress went before the timeline'</span>, <span class="hljs-function">-&gt;</span>
      isRightScope = <span class="hljs-literal">false</span>
      t = <span class="hljs-keyword">new</span> Timeline
        <span class="hljs-attribute">duration</span>: <span class="hljs-number">10</span>
        <span class="hljs-attribute">onFirstUpdate</span>:<span class="hljs-function">-&gt;</span>
      .start()
      t.update t.props.startTime + <span class="hljs-number">1</span>
      t.update t.props.startTime + -<span class="hljs-number">1</span>
      spyOn(t.o, <span class="hljs-string">'onFirstUpdate'</span>)
      t.update t.props.startTime + <span class="hljs-number">2</span>
      expect(t.o.onFirstUpdate).toHaveBeenCalled()

  describe <span class="hljs-string">'onFirstUpdateBackward callback -&gt;'</span>, <span class="hljs-function">-&gt;</span>
    it <span class="hljs-string">'should be defined'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline <span class="hljs-attribute">onFirstUpdateBackward</span>: <span class="hljs-function">-&gt;</span>
      expect(t.o.onFirstUpdateBackward).toBeDefined()
    it <span class="hljs-string">'should be called only on backward progress'</span>, <span class="hljs-function">-&gt;</span>
      isRightScope = <span class="hljs-literal">false</span>
      t = <span class="hljs-keyword">new</span> Timeline
        <span class="hljs-attribute">duration</span>: <span class="hljs-number">100</span>
        <span class="hljs-attribute">onFirstUpdateBackward</span>:<span class="hljs-function">-&gt;</span>
      .start()
      t.update t.props.startTime + <span class="hljs-number">500</span>
      spyOn(t.o, <span class="hljs-string">'onFirstUpdateBackward'</span>)
      t.update t.props.startTime + <span class="hljs-number">40</span>
      expect(t.o.onFirstUpdateBackward).toHaveBeenCalled()
    it <span class="hljs-string">'should be called just once'</span>, <span class="hljs-function">-&gt;</span>
      cnt = <span class="hljs-number">0</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">duration</span>: <span class="hljs-number">100</span>, <span class="hljs-attribute">onFirstUpdateBackward</span>:<span class="hljs-function">-&gt;</span> cnt++ ).start()
      t.prevTime = t.props.startTime + <span class="hljs-number">103</span>
      t.update t.props.startTime + <span class="hljs-number">90</span>
      t.update t.props.startTime + <span class="hljs-number">80</span>
      t.update t.props.startTime + <span class="hljs-number">70</span>
      expect(cnt).toBe <span class="hljs-number">1</span>
    it <span class="hljs-string">'should have the right scope'</span>, <span class="hljs-function">-&gt;</span>
      isRightScope = <span class="hljs-literal">false</span>
      t = <span class="hljs-keyword">new</span> Timeline
        <span class="hljs-attribute">duration</span>: <span class="hljs-number">10</span>
        <span class="hljs-attribute">onFirstUpdateBackward</span>:<span class="hljs-function">-&gt;</span> isRightScope = @ <span class="hljs-keyword">instanceof</span> Timeline
      t.start()
      t.update t.props.startTime + <span class="hljs-number">12</span>
      t.update t.props.startTime + <span class="hljs-number">9</span>
      expect(isRightScope).toBe <span class="hljs-literal">true</span>
    it <span class="hljs-string">'should be called after progress went further the timeline'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">duration</span>: <span class="hljs-number">10</span>, <span class="hljs-attribute">onFirstUpdateBackward</span>: <span class="hljs-function">-&gt;</span>)
        .start()
      t.prevTime = t.props.startTime + <span class="hljs-number">11</span>
      t.update t.props.startTime + <span class="hljs-number">9</span>
      t.update t.props.startTime + <span class="hljs-number">12</span>
      spyOn(t.o, <span class="hljs-string">'onFirstUpdateBackward'</span>)
      t.update t.props.startTime + <span class="hljs-number">9</span>
      expect(t.o.onFirstUpdateBackward).toHaveBeenCalled()
    it <span class="hljs-string">'should not be called at the start'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">duration</span>: <span class="hljs-number">10</span>, <span class="hljs-attribute">onFirstUpdateBackward</span>: <span class="hljs-function">-&gt;</span>)
        .start()
      spyOn(t.o, <span class="hljs-string">'onFirstUpdateBackward'</span>)
      t.update t.props.startTime + <span class="hljs-number">1</span>
      expect(t.o.onFirstUpdateBackward).<span class="hljs-keyword">not</span>.toHaveBeenCalled()
    it <span class="hljs-string">'should be called even if new time is less then start time'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline
        <span class="hljs-attribute">duration</span>: <span class="hljs-number">100</span>
        <span class="hljs-attribute">onFirstUpdateBackward</span>:<span class="hljs-function">-&gt;</span>
      .start()
      t.update t.props.startTime + <span class="hljs-number">500</span>
      spyOn(t.o, <span class="hljs-string">'onFirstUpdateBackward'</span>)
      t.update t.props.startTime - <span class="hljs-number">40</span>
      expect(t.o.onFirstUpdateBackward).toHaveBeenCalled()
    it <span class="hljs-string">'should be called ONCE if new time is less then start time'</span>, <span class="hljs-function">-&gt;</span>
      cnt = <span class="hljs-number">0</span>
      t = <span class="hljs-keyword">new</span> Timeline
        <span class="hljs-attribute">duration</span>: <span class="hljs-number">100</span>
        <span class="hljs-attribute">onFirstUpdateBackward</span>:<span class="hljs-function">-&gt;</span> cnt++
        <span class="hljs-attribute">isIt</span>: <span class="hljs-literal">true</span>
      .start()
      t.update t.props.startTime + <span class="hljs-number">500</span>
      t.update t.props.startTime - <span class="hljs-number">40</span>
      t.update t.props.startTime - <span class="hljs-number">100</span>
      expect(cnt).toBe <span class="hljs-number">1</span>

  describe <span class="hljs-string">'yoyo option -&gt;'</span>, <span class="hljs-function">-&gt;</span>
    it <span class="hljs-string">'should recieve yoyo option'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline <span class="hljs-attribute">yoyo</span>: <span class="hljs-literal">true</span>
      expect(t.o.yoyo).toBe <span class="hljs-literal">true</span>
    it <span class="hljs-string">'should toggle the progress direction on repeat'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">repeat</span>: <span class="hljs-number">2</span>, <span class="hljs-attribute">duration</span>: <span class="hljs-number">10</span>, <span class="hljs-attribute">yoyo</span>: <span class="hljs-literal">true</span>).start()
      time = t.props.startTime
      t.update(time+<span class="hljs-number">1</span>);   expect(t.progress).toBe .<span class="hljs-number">1</span>
      t.update(time+<span class="hljs-number">5</span>);   expect(t.progress).toBe .<span class="hljs-number">5</span>
      t.update(time+<span class="hljs-number">10</span>);  expect(t.progress).toBe <span class="hljs-number">1</span>

      t.update(time+<span class="hljs-number">11</span>);  expect(t.progress).toBe .<span class="hljs-number">9</span>
      t.update(time+<span class="hljs-number">15</span>);  expect(t.progress).toBe .<span class="hljs-number">5</span>
      t.update(time+<span class="hljs-number">19</span>);  expect(parseFloat t.progress.toFixed(<span class="hljs-number">1</span>)).toBe .<span class="hljs-number">1</span>

      t.update(time+<span class="hljs-number">20</span>);  expect(t.progress).toBe <span class="hljs-number">0</span>
      t.update(time+<span class="hljs-number">21</span>);  expect(t.progress).toBe .<span class="hljs-number">1</span>
      t.update(time+<span class="hljs-number">25</span>);  expect(t.progress).toBe .<span class="hljs-number">5</span>
      t.update(time+<span class="hljs-number">29</span>);  expect(t.progress).toBe .<span class="hljs-number">9</span>
      t.update(time+<span class="hljs-number">30</span>);  expect(t.progress).toBe <span class="hljs-number">1</span>
      expect(t.isCompleted).toBe <span class="hljs-literal">true</span>

  describe <span class="hljs-string">'easing -&gt;'</span>, <span class="hljs-function">-&gt;</span>
    it <span class="hljs-string">'should parse easing string'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">easing</span>: <span class="hljs-string">'Linear.None'</span>)
      expect(<span class="hljs-keyword">typeof</span> t.props.easing).toBe <span class="hljs-string">'function'</span>
    it <span class="hljs-string">'should parse standart easing'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">easing</span>: <span class="hljs-string">'Sin.Out'</span>, <span class="hljs-attribute">duration</span>: <span class="hljs-number">100</span>)
      t.start(); t.update(t.props.startTime + <span class="hljs-number">50</span>)
      expect(t.easedProgress).toBe easing.sin.out t.progress
    it <span class="hljs-string">'should work with easing function'</span>, <span class="hljs-function">-&gt;</span>
      easings = <span class="hljs-attribute">one</span>: <span class="hljs-function">-&gt;</span> a = <span class="hljs-number">1</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">easing</span>: easings.one)
      expect(t.props.easing.toString()).toBe easings.one.toString()
    it <span class="hljs-string">'should work with easing function'</span>, <span class="hljs-function"><span class="hljs-params">(dfr)</span>-&gt;</span>
      easings = <span class="hljs-attribute">one</span>:<span class="hljs-function"><span class="hljs-params">(k)</span>-&gt;</span> k
      spyOn easings, <span class="hljs-string">'one'</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">easing</span>: easings.one)
      t.start(); t.update t.props.startTime + <span class="hljs-number">40</span>
      setTimeout (<span class="hljs-function">-&gt;</span> expect(easings.one).toHaveBeenCalled(); dfr()), <span class="hljs-number">50</span>
  describe <span class="hljs-string">'setProc method -&gt;'</span>, <span class="hljs-function">-&gt;</span>
    it <span class="hljs-string">'should set the current progress'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline(<span class="hljs-attribute">easing</span>: <span class="hljs-string">'Bounce.Out'</span>)
      t.setProc .<span class="hljs-number">75</span>
      expect(t.progress).toBe .<span class="hljs-number">75</span>
      expect(t.easedProgress.toFixed(<span class="hljs-number">2</span>)).toBe <span class="hljs-string">'0.97'</span>
    it <span class="hljs-string">'should set new timeline options'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline <span class="hljs-attribute">duration</span>: <span class="hljs-number">100</span>, <span class="hljs-attribute">delay</span>: <span class="hljs-number">0</span>
      t.setProp <span class="hljs-attribute">duration</span>: <span class="hljs-number">1000</span>, <span class="hljs-attribute">delay</span>: <span class="hljs-number">200</span>
      expect(t.o.duration).toBe <span class="hljs-number">1000</span>
      expect(t.o.delay).toBe    <span class="hljs-number">200</span>
    it <span class="hljs-string">'should work with arguments'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline <span class="hljs-attribute">duration</span>: <span class="hljs-number">100</span>
      t.setProp <span class="hljs-string">'duration'</span>, <span class="hljs-number">1000</span>
      expect(t.o.duration).toBe <span class="hljs-number">1000</span>
    it <span class="hljs-string">'should call calcDimentions method'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline <span class="hljs-attribute">duration</span>: <span class="hljs-number">100</span>
      spyOn t, <span class="hljs-string">'calcDimentions'</span>
      t.setProp <span class="hljs-string">'duration'</span>, <span class="hljs-number">1000</span>
      expect(t.calcDimentions).toHaveBeenCalled()
    it <span class="hljs-string">'should update the totalTime'</span>, <span class="hljs-function">-&gt;</span>
      t = <span class="hljs-keyword">new</span> Timeline <span class="hljs-attribute">duration</span>: <span class="hljs-number">100</span>
      t.setProp <span class="hljs-string">'duration'</span>, <span class="hljs-number">1000</span>
      expect(t.props.totalTime).toBe <span class="hljs-number">1000</span>
      








      </div></div>
      
      </div>
    
    </div>
  </div>

  <script src="../../../toc.js"></script>
  <script src="../../../assets/libs.js"></script>
  <script src="../../../assets/behavior.js"></script>

  
    
      <script>
        
      </script>
    
  
</body>
</html>